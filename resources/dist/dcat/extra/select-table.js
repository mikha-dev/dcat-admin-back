!function(e){function t(e){e=$.extend({dialog:null,container:null,input:null,button:".submit-btn",cancel:".cancel-btn",table:".async-table",multiple:!1,max:0,values:[],lang:{exceed_max_item:Dcat.lang.exceed_max_item||"已超出最大可选择的数量"}},e);var t=this;t.options=e,t.$input=$(e.input),t.selected={},t.init()}t.prototype={init:function(){var e=this,t=e.options,n=t.values;for(var l in e.labels={},n)e.labels[n[l].id]=n[l].label;e.resetSelected(),$(document).on("dialog:shown",t.dialog,(function(){e.$dialog=$(t.dialog),e.$button=e.$dialog.find(t.button),e.$cancel=e.$dialog.find(t.cancel),e.$button.on("click",(function(){var t=e.getSelectedRows();e.setKeys(t[1]),e.render(t[0]),e.$dialog.trigger("dialog:close"),e.resetSelected()})),e.$cancel.on("click",(function(){e.$dialog.trigger("dialog:close")})),e.bind(),e.resetSelected()})),e.render(n)},bind:function(){var e=this,t=e.options;e.$dialog.find(t.table).on("table:loaded",(function(){var n=e.getCheckbox();t.multiple||$(this).find(".checkbox-grid-header").remove(),n.on("change",(function(){var l=$(this),i=l.data("id"),a=l.data("label");if(this.checked){if(t.multiple||(e.selected={}),e.selected[i]={id:i,label:a},t.max&&e.getSelectedRows()[0].length>t.max)return l.prop("checked",!1),delete e.selected[i],Dcat.warning(e.options.lang.exceed_max_item)}else delete e.selected[i];t.multiple||this.checked&&n.each((function(){var e=$(this);e.data("id")!=i&&(e.prop("checked",!1),e.parents("tr").css("background-color",""))}))})),n.each((function(){var t=$(this),n=t.data("id");for(var l in e.labels[n]=t.data("label"),e.selected)n!=l||t.prop("checked",!0).trigger("change");t.trigger("change")}))}))},resetSelected:function(){var e=this,t=e.getKeys();for(var n in e.selected={},t)e.selected[t[n]]={id:t[n],label:e.labels[t[n]]}},getCheckbox:function(){return this.$dialog.find('.checkbox-grid-column input[type="checkbox"]')},getSelectedRows:function(){var e=this,t=[],n=[];for(var l in e.selected)e.selected[l]&&(n.push(l),t.push(e.selected[l]));return[t,n]},render:function(e){var t=this,n=t.options,l=$(n.container),i=l.find(".default-text"),a=l.find(".option");return e&&e.length?(i.addClass("d-none"),a.removeClass("d-none"),n.multiple?function(e,t,n){var l=[],i=$(n.container),a=i.find(".default-text"),o=i.find(".option");for(var c in i.hasClass("select2")||i.addClass("select2 select2-container select2-container--default select2-container--below"),i.removeClass("form-control"),e)l.push('<li class="select2-selection__choice" >\n    '.concat(e[c].label,' <span data-id="').concat(e[c].id,'" class="select2-selection__choice__remove remove " role="presentation"> ×</span>\n</li>'));l.unshift('<span class="select2-selection__clear remove-all">×</span>'),l='<span class="select2-selection select2-selection--multiple">\n <ul class="select2-selection__rendered">'.concat(l.join(""),"</ul>\n </span>");var s=$(l);function d(){o.html(""),a.removeClass("d-none"),o.addClass("d-none"),i.addClass("form-control"),t.setKeys([])}o.html(s),s.find(".remove").on("click",(function(){var e=$(this);t.deleteKey(e.data("id")),e.parent().remove(),t.getKeys().length||d()})),s.find(".remove-all").on("click",d)}(e,t,n):function(e,t,n){var l=$(n.container),i=l.find(".default-text"),a=l.find(".option"),o=$("<div class='pull-right ' style='font-weight:bold;cursor:pointer'>×</div>");a.text(e[0].label),a.append(o),o.on("click",(function(){t.setKeys([]),i.removeClass("d-none"),a.addClass("d-none")}))}(e,t,n)):(i.removeClass("d-none"),a.addClass("d-none"),void(n.multiple&&l.addClass("form-control")))},setKeys:function(e){this.$input.val(e.length?e.join(","):"").trigger("change")},deleteKey:function(e){var t=this.getKeys(),n=[];for(var l in t)t[l]!=e&&n.push(t[l]);this.setKeys(n)},getKeys:function(){var e=this.$input.val();return e?String(e).split(","):[]}},Dcat.grid.SelectTable=function(e){return new t(e)}}(window);
//# sourceMappingURL=select-table.js.map