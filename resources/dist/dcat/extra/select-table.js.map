{"version":3,"file":"/resources/dist/dcat/extra/select-table.js","mappings":"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","sources":["webpack:///./resources/assets/dcat/extra/select-table.js"],"sourcesContent":["(function (w) {\n    function SelectTable(options) {\n        options = $.extend({\n            dialog: null,\n            container: null,\n            input: null,\n            button: '.submit-btn',\n            cancel: '.cancel-btn',\n            table: '.async-table',\n            multiple: false,\n            max: 0,\n            values: [],\n            lang: {\n                exceed_max_item: Dcat.lang.exceed_max_item || '已超出最大可选择的数量',\n            },\n        }, options);\n\n        let self = this;\n\n        self.options = options;\n        self.$input = $(options.input);\n        self.selected = {}; // 保存临时选中的ID\n\n        self.init();\n    }\n\n    SelectTable.prototype = {\n        init() {\n            let self = this,\n                options = self.options,\n                values = options.values;\n\n            self.labels = {};\n\n            for (let i in values) {\n                self.labels[values[i]['id']] = values[i]['label']\n            }\n\n            // 保存临时选中的值\n            self.resetSelected();\n\n            $(document).on('dialog:shown', options.dialog, function () {\n                self.$dialog = $(options.dialog);\n                self.$button = self.$dialog.find(options.button);\n                self.$cancel = self.$dialog.find(options.cancel);\n\n                // 提交按钮\n                self.$button.on('click', function () {\n                    var selected = self.getSelectedRows();\n\n                    self.setKeys(selected[1]);\n\n                    self.render(selected[0]);\n\n                    self.$dialog.trigger('dialog:close');\n\n                    // 重置已选中数据\n                    self.resetSelected();\n                });\n\n                // 取消按钮\n                self.$cancel.on('click', function () {\n                    self.$dialog.trigger('dialog:close');\n                });\n\n                // 绑定相关事件\n                self.bind();\n\n                // 重置已选中数据\n                self.resetSelected();\n            });\n\n            // 渲染选中的数据\n            self.render(values);\n        },\n\n        bind() {\n            let self = this,\n                options = self.options;\n\n            // 表格加载完成事件\n            self.$dialog.find(options.table).on('table:loaded', function () {\n                let checkbox = self.getCheckbox();\n\n                if (! options.multiple) {\n                    // 移除全选按钮\n                    $(this).find('.checkbox-grid-header').remove();\n                }\n\n                checkbox.on('change', function () {\n                    let $this = $(this),\n                        id = $this.data('id'),\n                        label = $this.data('label');\n\n                    if (this.checked) {\n                        if (! options.multiple) {\n                            self.selected = {};\n                        }\n                        self.selected[id] = {id: id, label: label};\n\n                        // 多选\n                        if (options.max && (self.getSelectedRows()[0].length > options.max)) {\n                            $this.prop('checked', false);\n                            delete self.selected[id];\n\n                            return Dcat.warning(self.options.lang.exceed_max_item);\n                        }\n                    } else {\n                        delete self.selected[id];\n                    }\n\n                    if (! options.multiple) {\n                        if (this.checked) {\n                            // 单选效果\n                            checkbox.each(function () {\n                                let $this = $(this);\n\n                                if ($this.data('id') != id) {\n                                    $this.prop('checked', false);\n                                    $this.parents('tr').css('background-color', '');\n                                }\n                            });\n                        }\n                    }\n                });\n\n                // 选中默认选项\n                checkbox.each(function () {\n                    let $this = $(this),\n                        current = $this.data('id');\n\n                    // 保存label字段\n                    self.labels[current] = $this.data('label');\n\n                    for (let i in self.selected) {\n                        if (current == i) {\n                            $this.prop('checked', true).trigger('change');\n\n                            continue;\n                        }\n                    }\n\n                    $this.trigger('change');\n                });\n            })\n        },\n\n        // 重置已选中数据\n        resetSelected() {\n            let self = this,\n                keys = self.getKeys();\n\n            self.selected = {};\n\n            for (let i in keys) {\n                self.selected[keys[i]] = {id: keys[i], label: self.labels[keys[i]]};\n            }\n        },\n\n        getCheckbox() {\n            return this.$dialog.find('.checkbox-grid-column input[type=\"checkbox\"]');\n        },\n\n        getSelectedRows() {\n            let self = this,\n                selected = [],\n                ids = [];\n\n            for (let i in self.selected) {\n                if (! self.selected[i]) {\n                    continue;\n                }\n\n                ids.push(i);\n                selected.push(self.selected[i])\n            }\n\n            return [selected, ids];\n        },\n\n        render(selected) {\n            let self = this,\n                options = self.options,\n                box = $(options.container),\n                placeholder = box.find('.default-text'),\n                option = box.find('.option');\n\n            if (! selected || ! selected.length) {\n                placeholder.removeClass('d-none');\n                option.addClass('d-none');\n\n                if (options.multiple) {\n                    box.addClass('form-control');\n                }\n\n                return;\n            }\n\n            placeholder.addClass('d-none');\n            option.removeClass('d-none');\n\n            if (! options.multiple) {\n                return renderDefault(selected, self, options);\n            }\n\n            return renderMultiple(selected, self, options);\n        },\n\n        setKeys(keys) {\n            // 手动触发change事件，方便监听值变化\n            this.$input.val(keys.length ? keys.join(',') : '').trigger('change');\n        },\n\n        deleteKey(key) {\n            let val = this.getKeys(),\n                results = [];\n\n            for (let i in val) {\n                if (val[i] != key) {\n                    results.push(val[i])\n                }\n            }\n\n            this.setKeys(results)\n        },\n\n        getKeys() {\n            let val = this.$input.val();\n\n            if (! val) return [];\n\n            return String(val).split(',');\n        },\n    };\n\n    // 多选\n    function renderMultiple(selected, self, options) {\n        let html = [],\n            box = $(options.container),\n            placeholder = box.find('.default-text'),\n            option = box.find('.option');\n\n        if (! box.hasClass('select2')) {\n            box.addClass('select2 select2-container select2-container--default select2-container--below');\n        }\n        box.removeClass('form-control');\n\n        for (let i in selected) {\n            html.push(`<li class=\"select2-selection__choice\" >\n    ${selected[i]['label']} <span data-id=\"${selected[i]['id']}\" class=\"select2-selection__choice__remove remove \" role=\"presentation\"> ×</span>\n</li>`);\n        }\n\n        html.unshift('<span class=\"select2-selection__clear remove-all\">×</span>');\n\n        html = `<span class=\"select2-selection select2-selection--multiple\">\n <ul class=\"select2-selection__rendered\">${html.join('')}</ul>\n </span>`;\n\n        var $tags = $(html);\n\n        option.html($tags);\n\n        $tags.find('.remove').on('click', function () {\n            var $this = $(this);\n\n            self.deleteKey($this.data('id'));\n\n            $this.parent().remove();\n\n            if (! self.getKeys().length) {\n                removeAll();\n            }\n        });\n\n        function removeAll() {\n            option.html('');\n            placeholder.removeClass('d-none');\n            option.addClass('d-none');\n\n            box.addClass('form-control');\n\n            self.setKeys([]);\n        }\n\n        $tags.find('.remove-all').on('click', removeAll);\n    }\n\n    // 单选\n    function renderDefault(selected, self, options) {\n        let box = $(options.container),\n            placeholder = box.find('.default-text'),\n            option = box.find('.option');\n\n        var remove = $(\"<div class='pull-right ' style='font-weight:bold;cursor:pointer'>×</div>\");\n\n        option.text(selected[0]['label']);\n        option.append(remove);\n\n        remove.on('click', function () {\n            self.setKeys([]);\n            placeholder.removeClass('d-none');\n            option.addClass('d-none');\n        });\n    }\n\n    Dcat.grid.SelectTable = function (opts) {\n        return new SelectTable(opts)\n    };\n})(window)"],"names":["w","SelectTable","options","$","extend","dialog","container","input","button","cancel","table","multiple","max","values","lang","exceed_max_item","Dcat","self","this","$input","selected","init","prototype","i","labels","resetSelected","document","on","$dialog","$button","find","$cancel","getSelectedRows","setKeys","render","trigger","bind","checkbox","getCheckbox","remove","$this","id","data","label","checked","length","prop","warning","each","parents","css","current","keys","getKeys","ids","push","box","placeholder","option","addClass","removeClass","html","hasClass","concat","unshift","join","$tags","removeAll","deleteKey","parent","renderMultiple","text","append","renderDefault","val","key","results","String","split","grid","opts","window"],"sourceRoot":""}